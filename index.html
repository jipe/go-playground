<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <style>
      body {
        margin: 0px;
        background-color: #fff;
        color: #333;
        font-family: sans-serif;
        text-align: center;
      }

      header, footer, main {
        width: 1200px;
        margin: 0px auto;
      }

      header {
        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        font-style: italic;
        font-size: 2em;
      }

      footer {
        margin: 1em auto;
      }

      .player {
        width: 300px;
        float: left;
        height: 500px;
        margin-top: 50px;
        background-image: linear-gradient(to bottom, #def, #789);
        box-shadow: 0px 0px 10px rgba(0,0,0,0.7) inset;
        color: #333;
        text-shadow: 1px 1px 1px rgba(0,0,0,0.2);
        font-size: 16pt;
        text-align: left;
      }

      .player h3 {
        text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        font-style: italic;
        color: #fff;
        padding: 1em 1em;
        background-color: #000;
        margin-top: 0px;
        text-align: center;
      }

      .player h4 {
        margin: 1em;
        color: #333;
        text-shadow: 1px 1px 0px #fff;
        border-bottom: 2px #def groove;
      }

      .player.current {
      }

      #black {
        border-radius: 10px 0px 0px 10px;
      }

      #black h3 {
        border-radius: 10px 0px 0px 0px;
      }

      #white {
        border-radius: 0px 10px 10px 0px;
      }

      #white h3 {
        border-radius: 0px 10px 0px 0px;
      }

      form {
        text-align: left;
        margin: 1em;
        text-shadow: none;
        font-size: 12pt;
        text-shadow: 1px 1px 0px #fff;
      }

      #go-board {
        box-shadow: 2px 2px 5px rgba(0,0,0,0.7);
        background-image: linear-gradient(to bottom, #f0d080, #e0c070);
        margin: 0px;
        border-radius: 5px;
        float: left;
      }

      .clear-both {
        clear: both;
      }

      input[type="radio"] {
        float: left;
        clear: both;
        margin-right: 0.5em;
      }

      label {
        display: block;
      }

      #board-controls {
        margin-top: 1em;
      }

      a {
        color: #00c;
      }
      
      #messages {
        font-size: 24pt;
        text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
        font-style: italic;
        font-weight: bold;
        margin-top: 0.5em;
      }

      .hidden {
        display: none;
      }
    </style>
    <script src="javascript/go.js"></script>
    <script>
      var defiantGo = (function () {
        var rules;
        var scoring;
        var board;
        var game;
        var widget;
        var players = {};

        function setDisabled(ids, value) {
          var i;

          for (i = 0; i < ids.length; i++) {
            document.getElementById(ids[i]).disabled = value;
          }
        }

        function disable(ids) {
          setDisabled(ids, true);
        }

        function enable(ids) {
          setDisabled(ids, false);
        }

        return {
          init : function (size, canvasId) {
            rules   = go.createRules();
            scoring = go.createScoring();
            board   = go.createBoard(9);
            game    = go.createGame(board, rules, scoring);
            widget  = go.createBoardWidget(canvasId, board, game);

            this.newGame();
          },

          setBoardSize : function (size) {
            board        = go.createBoard(size);
            game         = go.createGame(board, rules, scoring);
            widget.board = board;
            widget.game  = game;

            widget.render();
          },

          setPlayer : function (color, player) {
            players[color] = player;
            if (players.black && players.white) {
              document.getElementById('start-game').disabled = false;
              this.showMessage('Ready to start');
            }
          },

          passMove : function () {
            game.pass();
          },

          startGame : function () {
            var control = this;

            if (players.black && players.white) {
              game.addEventListener((function () {
                return {
                  onStateChanged : function (previousState, currentState) {
                    console.log('onStateChanged: ' + previousState + ", " + currentState);
                    switch (currentState) {
                    case 'PLACE_BLACK_STONE':
                      break;
                    case 'PLACE_WHITE_STONE':
                      break;
                    case 'ENDED':
                      control.showMessage("Game over");
                      break;
                    };
                  },

                  onStonePlaced : function (color, x, y) {
                    console.log("onStonePlaced: " + color + ", " + x + ", " + y);
                    control.clearMessage();
                  },

                  onTurnPassed : function (color) {
                    switch (color) {
                    case 'BLACK':
                      control.showMessage('Black passed his turn');
                      break;
                    case 'WHITE':
                      control.showMessage('White passed his turn');
                      break;
                    };
                  },

                  onStoneCaptured : function (positions) {
                    console.log("onStoneCaptured: " + positions);
                  },

                  onPlayerAdded : function (color, name) {
                    console.log("onPlayerAdded");
                    control.showMessage("Player " + name + " added!");
                  }
                };
              })());
              game.addPlayer(players.black);
              game.addPlayer(players.white);
              widget.attachUiControls();

              disable(['size-9x9', 'size-13x13', 'size-19x19', 'start-game', 'white-player-type-human', 'black-player-type-human']);
              enable(['new-game', 'pass-move']);
              this.clearMessage();
            }
          },

          clearPlayers : function () {
            var i;
            var ids = ['black-player-type-human', 'white-player-type-human'];

            players = {};
            for (i = 0; i < ids.length; i++) {
              document.getElementById(ids[i]).checked = false;
            }
          },

          showMessage : function (message) {
            document.getElementById('messages').innerHTML = message;
          },

          clearMessage : function () {
            document.getElementById('messages').innerHTML = '';
          },

          newGame : function () {
            document.getElementById('new-game').blur();
            widget.detachUiControls();
            board = go.createBoard(board.size);
            game  = go.createGame(board, rules, scoring);
            widget.board = board;
            widget.game  = game;
            
            disable(['new-game', 'pass-move']);
            enable(['size-9x9', 'size-13x13', 'size-19x19', 'black-player-type-human', 'white-player-type-human']);
            this.clearPlayers();
            widget.render();
            this.showMessage('Select board size and player types');
          }
        };
      })();
    </script>
  </head>
  <body>
    <header>
      <h1>Go &mdash; 圍棋</h1>
    </header>
    <main>
      <div id="black" class="player current">
        <h3>Black</h3>
        <h4>Player Type</h4>
        <form>
          <input type="radio" name="black-player-type" value="human" id="black-player-type-human" onclick="defiantGo.setPlayer('black', 'human')">
          <label for="black-player-type-human">Human</label>
          <!--
          <input type="radio" name="black-player-type" value="computer" id="black-player-type-computer" onclick="defiantGo.setPlayer('black', 'computer');">
          <label for="black-player-type-computer">Computer</label>
          -->
        </form>
      </div>
      <canvas width="600" id="go-board"></canvas>
      <div id="white" class="player">
        <h3>White</h3>
        <h4>Player Type</h4>
        <form>
          <input type="radio" name="white-player-type" value="human" id="white-player-type-human" onclick="defiantGo.setPlayer('white', 'human');">
          <label for="white-player-type-human">Human</label>
          <!--
          <input type="radio" name="white-player-type" value="computer" id="white-player-type-computer" onclick="defiantGo.setPlayer('white', 'computer');">
          <label for="white-player-type-computer">Computer</label>
          -->
        </form>
      </div>
      <div class="clear-both"></div>
      <div id="board-controls">
        <button id="size-9x9"   onclick="defiantGo.setBoardSize(9);">9&times;9</button>
        <button id="size-13x13" onclick="defiantGo.setBoardSize(13);">13&times;13</button>
        <button id="size-19x19" onclick="defiantGo.setBoardSize(19);">19&times;19</button>
        <button id="start-game" onclick="defiantGo.startGame();" disabled="disabled">Start game</button>
        <button id="pass-move"  onclick="defiantGo.passMove();" disabled="disabled">Pass</button>
        <button id="new-game"   onclick="defiantGo.newGame();" disabled="disabled">New game</button>
      </div>
      <div id="messages"></div>
    </main>
    <footer>
    </footer>
    <script>
      defiantGo.init(9, 'go-board');
    </script>
  </body>
</html>
